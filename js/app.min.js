document.datwik_api_url=window.location.origin;
let buildParams$$module$js$util$util=function(a,b){var c=[];b.page&&c.push(`page=${b.page}`);b.sort&&c.push(`sort=${b.sort}`);b.search&&c.push(`search=${b.search}`);b.tag&&c.push(`tag=${b.tag}`);b.layout&&c.push(`layout=${b.layout}`);return a+(0<c.length?"?"+c.join("&"):"")},loadParams$$module$js$util$util=function(a){var b=window.location.href.slice(window.location.href.indexOf("?")+1);b=new URLSearchParams(b);var c=parseInt(b.get("page"));a.page=isNaN(c)?1:Math.max(1,c);c=parseInt(b.get("sort"));
a.sort=isNaN(c)?null:c;a.search=b.get("search");a.tag=b.get("tag");a.layout=b.get("layout")},slug$$module$js$util$util=function(a){if(!a)return"";a=a.trim().toLowerCase().replace(/[^a-zA-Z]+/g,"|");if(!a)return"";a=a.split("|");return a.length?a.slice(0,10).filter(b=>2<b.trim().length).join("-"):""};String.prototype.capitalize=function(){return this.replace(/(^|\s)([a-z])/g,function(a,b,c){return b+c.toUpperCase()})};
let formatMoney$$module$js$util$util=function(a){a&&""!=a||(a="0.00");let b=a?a:"0.00";b=a&&a.toFixed?a.toFixed(2):b;return parseFloat(b).toLocaleString("en-CA",{style:"currency",currency:"CAD"})},isEmpty$$module$js$util$util=function(a,b){return!isNotEmpty$$module$js$util$util(a,b)},isNotEmpty$$module$js$util$util=function(a,b){var c=void 0!=a&&null!=a;if(c)if(b)c=0<b.filter(d=>d.d==a).length;else if("string"===typeof a||a instanceof String)c=""!=a.trim();return c},FieldType$$module$js$util$util=
{INTEGER:0,STRING:1,MONEY:2,URL:4,OPTION:9,TEXTAREA:11,EMAIL:12},MetaObjectType$$module$js$util$util={FEEDBACK:2,CONTACT_US:3},compile_template$$module$js$util$util=function(a){a=$(a).html();return void 0!==a?Handlebars.compile(a):null},record_change_helper$$module$js$util$util={fieldInputs:function(a){let b=$(`#dynamic-field-${a.id}-value`);return"URL"==a.type?[b,$(`#dynamic-field-${a.id}-url`)]:[b]},recordModalValues:function(a){let b=[];a.fields.forEach(c=>{let d=record_change_helper$$module$js$util$util.fieldInputs(c),
e=d[0].val();"URL"==c.type?(c=d[1].val(),b.push({value:e,url:c})):b.push(e)});return b},addRecordContactUs:function(a){let b=this.recordModalValues(a);a=dataset_helper$$module$js$util$util.createForAdd(a,b);return rest$$module$js$util$util.post(document.datwik_api_url+"/action/contactus",a)},addRecord:function(a){let b=this.recordModalValues(a);a=dataset_helper$$module$js$util$util.createForAdd(a,b);return rest$$module$js$util$util.post(document.datwik_api_url+"/action/dataset",a)},updateRecord:function(a,
b){let c=this.recordModalValues(a);a=dataset_helper$$module$js$util$util.createForUpdate(a,b,c);return rest$$module$js$util$util.put(document.datwik_api_url+"/action/dataset",a)}},dataset_helper$$module$js$util$util={initDataSet:function(){let a=new Map;a.records=[];return a},setValues:function(a,b,c){let d=[];b.vals=d;a.fields.forEach(function(e,f){f=c[f];if("INTEGER"==e.type||"OPTION"==e.type||"MONEY"==e.type)if(null==f||""==f)f=null;else try{f=Number(f)}catch(g){f=null}d.push(f)})},createForAdd:function(a,
b){let c=this.initDataSet();c.meta=a;let d=new Map;c.records.push(d);this.setValues(a,d,b);return c},createForUpdate:function(a,b,c){let d=this.initDataSet();d.meta=a;let e=new Map;e.id=b;d.records.push(e);this.setValues(a,e,c);return d},createForDelete:function(a,b){let c=this.initDataSet(a);c.meta={id:a.id};b.forEach(d=>{c.records.push({id:d})});return c}},meta_helper$$module$js$util$util={topic:{name:"topic",fields:[{name:"topic",type:FieldType$$module$js$util$util.STRING},{name:"dataset",type:FieldType$$module$js$util$util.INTEGER},
{name:"tags",type:FieldType$$module$js$util$util.STRING},{name:"description",type:FieldType$$module$js$util$util.TEXTAREA}]},types:{service:{name:"service",fields:[{name:"vendor",type:FieldType$$module$js$util$util.STRING},{name:"product",type:FieldType$$module$js$util$util.URL},{name:"price",type:FieldType$$module$js$util$util.MONEY},{name:"frequency",type:FieldType$$module$js$util$util.OPTION,options:[{d:1,v:"Month"},{d:2,v:"Year"},{d:3,v:"Week"},{d:4,v:"2 weeks"},{d:5,v:"3 months"},{d:6,v:"6 months"},
{d:7,v:"Day"},{d:8,v:"2 years"}]},{name:"description",type:FieldType$$module$js$util$util.TEXTAREA}]},product:{name:"product",fields:[{name:"vendor",type:FieldType$$module$js$util$util.STRING},{name:"product",type:FieldType$$module$js$util$util.URL},{name:"price",type:FieldType$$module$js$util$util.MONEY},{name:"description",type:FieldType$$module$js$util$util.TEXTAREA}]},link:{name:"link",fields:[{name:"name",type:FieldType$$module$js$util$util.URL},{name:"description",type:FieldType$$module$js$util$util.TEXTAREA}]}},
contact_us_render_meta:{type:MetaObjectType$$module$js$util$util.CONTACT_US,fields:[{name:"email",type:"EMAIL",id:1},{name:"category",type:"OPTION",options:[{d:1,v:"General"},{d:2,v:"Registration"},{d:3,v:"Volunteer"},{d:4,v:"Bug/Issue"},{d:5,v:"Security/Vulnerability"},{d:6,v:"Enhancement"}],id:2},{name:"message",type:"TEXTAREA",id:3}]}},rest$$module$js$util$util={get:async function(a){var b=new Date;return axios({url:a,method:"get",headers:{}}).then(function(c){console.log("get",": ",new Date-b);
return c.data}).catch(function(c){throw Error(c);})},_change:async function(a,b,c){var d=new Date;return axios({url:a,method:c,headers:{},data:b,withCredentials:!0}).then(function(e){console.log(c,": ",new Date-d);return e.data}).catch(e=>{if(e.response&&e.response.data.m)throw Error(e.response.data.m);throw Error(e.message);})},post:async function(a,b){return this._change(a,b,"post")},put:async function(a,b){return this._change(a,b,"put")},delete:async function(a,b){return this._change(a,b,"delete")}};
var module$js$util$util={};module$js$util$util.FieldType=FieldType$$module$js$util$util;module$js$util$util.buildParams=buildParams$$module$js$util$util;module$js$util$util.compile_template=compile_template$$module$js$util$util;module$js$util$util.dataset_helper=dataset_helper$$module$js$util$util;module$js$util$util.formatMoney=formatMoney$$module$js$util$util;module$js$util$util.isEmpty=isEmpty$$module$js$util$util;module$js$util$util.isNotEmpty=isNotEmpty$$module$js$util$util;
module$js$util$util.loadParams=loadParams$$module$js$util$util;module$js$util$util.meta_helper=meta_helper$$module$js$util$util;module$js$util$util.record_change_helper=record_change_helper$$module$js$util$util;module$js$util$util.rest=rest$$module$js$util$util;module$js$util$util.slug=slug$$module$js$util$util;let toast_helper$$module$js$util$modal={toastTemplate:Handlebars.compile($("#toast-template").html()),show:function(a,b){$("#app-toast").html(this.toastTemplate({message:a,background:b}));(new bootstrap.Toast($("#toast"))).show()}},modal_helper$$module$js$util$modal={el:"#app-modal",m:function(){return bootstrap.Modal.getOrCreateInstance($(".modal",this.el)[0],{keyboard:!1,backdrop:"static"})},validate:function(a){a.fields.forEach(d=>{record_change_helper$$module$js$util$util.fieldInputs(d).forEach(e=>
{e.prop("classList").remove("is-invalid");e.prop("classList").remove("is-valid")})});$("#overall-form-validator")[0].classList.remove("is-invalid");let b=record_change_helper$$module$js$util$util.recordModalValues(a),c=a.fields.every((d,e)=>{e=b[e];return"OPTION"==d.type?!0:"URL"==d.type?isEmpty$$module$js$util$util(e.v)&&isEmpty$$module$js$util$util(e.url):isEmpty$$module$js$util$util(e)});a=a.fields.map((d,e)=>{var f=b[e];e=record_change_helper$$module$js$util$util.fieldInputs(d);var g=!0,h=!0;
if("OPTION"!=d.type)if("INTEGER"==d.type)isNotEmpty$$module$js$util$util(f)&&(h=!1,g=validator.isInt(f),e[0].prop("classList").add(g?"is-valid":"is-invalid"));else if("MONEY"==d.type)isNotEmpty$$module$js$util$util(f)&&(h=!1,g=validator.isDecimal(f,{decimal_digits:"0,2"}),e[0].prop("classList").add(g?"is-valid":"is-invalid"));else if("EMAIL"==d.type)isNotEmpty$$module$js$util$util(f)&&(h=!1,g=validator.isEmail(f),e[0].prop("classList").add(g?"is-valid":"is-invalid"));else if("URL"==d.type){if(isNotEmpty$$module$js$util$util(f.value)||
isNotEmpty$$module$js$util$util(f.url))h=!1,d=validator.isLength(f.value,{min:3,max:250}),f=isEmpty$$module$js$util$util(f.url)||validator.isURL(f.url),e[0].prop("classList").add(d?"is-valid":"is-invalid"),e[1].prop("classList").add(f?"is-valid":"is-invalid"),g=d&&f}else isNotEmpty$$module$js$util$util(f)&&(h=!1,g=validator.isLength(f,{min:3,max:250}),e[0].prop("classList").add(g?"is-valid":"is-invalid"));return h||!h&&g}).reduce((d,e)=>d&&e);c&&$("#overall-form-validator")[0].classList.add("is-invalid");
return!c&&a},setDefaultContextValues:function(a){a.okButtonText||(a.okButtonText="Save changes");return a},show:async function(a){a=this.setDefaultContextValues(a);let b=a.template(a),c=a.onConfirm,d=a.confirmToastMessage,e=this;$(this.el).html("");$(this.el).html(b);$("button[name='modal-confirm']").off();$(".modal",this.el).off();this.m().show();return(new Promise((f,g)=>{let h=$("button[data-action='modal-confirm']");h.click(k=>{k.preventDefault();if(!a.meta||e.validate(a.meta))h.addClass("disabled"),
h.html('<i class="fas fa-spinner fa-pulse"></i>&nbsp;'+h.html()),f()})})).then(f=>c(f)).then(f=>{d&&toast_helper$$module$js$util$modal.show(d,"text-white bg-success")}).then(()=>e.hide()).catch(function(f){e.hide();toast_helper$$module$js$util$modal.show(`Error: ${f.message}`,"text-white bg-danger");throw Error(f.message);})},hide:function(){return this.m().hide()}};var module$js$util$modal={};module$js$util$modal.modal_helper=modal_helper$$module$js$util$modal;module$js$util$modal.toast_helper=toast_helper$$module$js$util$modal;const Login$$module$js$module$login={el:null,template:compile_template$$module$js$util$util("#login-template"),profileNavTemplate:compile_template$$module$js$util$util("#profile-nav-template"),dynamicTableAddModalTemplate:compile_template$$module$js$util$util("#dynamic-table-record-modal-template"),_authenticated:!1,events:function(){var a=this;$("*[data-action='register']").off();$("*[data-action='register']").click(b=>{b.preventDefault();window.app.router().navigateTo("/register")});$("*[data-action='login']").off();
$("*[data-action='login']").click(b=>{b.preventDefault();let c={fields:[{field_index:0,id:1,name:"Username",seqindex:0,type:"USERNAME"},{field_index:1,id:2,name:"Password",seqindex:1,type:"PASSWORD"}]};modal_helper$$module$js$util$modal.show({template:a.dynamicTableAddModalTemplate,title:"Login",meta:c,okButtonText:"Login",onConfirm:function(){let d=record_change_helper$$module$js$util$util.recordModalValues(c),e={username:d[0],password:d[1]};rest$$module$js$util$util.post(document.datwik_api_url+
"/auth/login",e).then(f=>{a._authenticated=!0;a._renderProfileNav(f);a._showLoginItems();toast_helper$$module$js$util$modal.show(`Successfully logged in ${e.username}`,"text-white bg-success")}).catch(f=>{console.log(f);a._authenticated=!1;toast_helper$$module$js$util$modal.show(`Error during login: ${f.message}`,"text-white bg-danger")})}})});$("*[data-action='logout']").off();$("*[data-action='logout']").click(b=>{b.preventDefault();rest$$module$js$util$util.post(document.datwik_api_url+"/auth/logout").then(c=>
{a._authenticated=!1;a._showLogoutItems();toast_helper$$module$js$util$modal.show("Sucessfully logged out","text-white bg-success")}).catch(c=>{toast_helper$$module$js$util$modal.show(`Error during logout: ${c.message}`,"text-white bg-danger")})})},_showLoginItems(){$("*[data-auth='in']").removeClass("d-none");$("*[data-auth='out']").addClass("d-none")},_showLogoutItems(){$("*[data-auth='out']").removeClass("d-none");$("*[data-auth='in']").addClass("d-none")},init:function(a){this.el=a;this.render()},
render:function(){this.el.html(this.template({}));this.events()},_renderProfileNav:function(a){$("*[data-section='profile-nav']").html(this.profileNavTemplate(a))},initAuthMenuItems:function(){let a=this;Login$$module$js$module$login.events();rest$$module$js$util$util.post(document.datwik_api_url+"/auth/authenticated").then(b=>{a._authenticated=!0;a._renderProfileNav(b);a._showLoginItems()}).catch(b=>{a._authenticated=!1;a._showLogoutItems()})},isAuthenticated(){return this._authenticated}};
var module$js$module$login={};module$js$module$login.Login=Login$$module$js$module$login;let showContactUsDialog$$module$js$module$contact_us=function(a){a||="Please enter your email if you would like to get a reply. This will be sent privately to website administrators.";let b=meta_helper$$module$js$util$util.contact_us_render_meta;modal_helper$$module$js$util$modal.show({template:DataTable$$module$js$module$table.dynamicTableAddModalTemplate,title:"Contact Us",meta:b,text:a,confirmToastMessage:"Thank you, your message was received!",onConfirm:function(){return record_change_helper$$module$js$util$util.addRecordContactUs(b)}})},
showNotLoggedInMessage$$module$js$module$contact_us=function(){window.readOnlyWebsite?showContactUsDialog$$module$js$module$contact_us('To get invitation for <img src="https://assets.datwik.com/img/datwik-logo-grey.png" width="16" height="16"/> <b>datwik.com</b> <i> alpha testing</i>: <ul> <li> Enter your email address <li> Choose "Registration" <li> Describe your interest (250 letters or less) </ul>We will contact you shortly with next steps.'):toast_helper$$module$js$util$modal.show("Please login to perform this action",
"text-white bg-danger")};var module$js$module$contact_us={};module$js$module$contact_us.showContactUsDialog=showContactUsDialog$$module$js$module$contact_us;module$js$module$contact_us.showNotLoggedInMessage=showNotLoggedInMessage$$module$js$module$contact_us;const FEEDBACK_DATASET$$module$js$module$table=2,DataTable$$module$js$module$table={el:null,loadingTemplate:Handlebars.compile($("#dataset-loading-template").html()),dynamicTableAddModalTemplate:compile_template$$module$js$util$util("#dynamic-table-record-modal-template"),confirmModalTemplate:compile_template$$module$js$util$util("#confirm-modal-template"),dataset_id:null,dataset_title:null,page:0,sort:null,search:null,layout:null,events:function(a){var b=this;$("*[data-action='add']").off();$("*[data-action='add']").click(c=>
{c.preventDefault();Login$$module$js$module$login.isAuthenticated()?modal_helper$$module$js$util$modal.show({template:b.dynamicTableAddModalTemplate,title:"Add record",meta:a.meta,confirmToastMessage:"Record added!",onConfirm:function(){return record_change_helper$$module$js$util$util.addRecord(a.meta)}}).then(()=>{b._setLastPage();b._navigatePage()}):showNotLoggedInMessage$$module$js$module$contact_us()});$("*[data-action='update']").off();$("*[data-action='update']").click(c=>{c.preventDefault();
if(Login$$module$js$module$login.isAuthenticated()){var d=$(c.currentTarget).data("record-id");c=a.records.filter(e=>e.id==d)[0];modal_helper$$module$js$util$modal.show({template:b.dynamicTableAddModalTemplate,title:"Edit record",meta:a.meta,record:c.vals,confirmToastMessage:"Record updated!",onConfirm:function(){return record_change_helper$$module$js$util$util.updateRecord(a.meta,d)}}).then(()=>{location.reload()})}else showNotLoggedInMessage$$module$js$module$contact_us()});$("*[data-action='clone']").off();
$("*[data-action='clone']").click(c=>{c.preventDefault();if(Login$$module$js$module$login.isAuthenticated()){var d=$(c.currentTarget).data("record-id");c=a.records.filter(e=>e.id==d)[0];modal_helper$$module$js$util$modal.show({template:b.dynamicTableAddModalTemplate,title:"Clone record",meta:a.meta,record:c.vals,confirmToastMessage:"Record updated!",onConfirm:function(){return record_change_helper$$module$js$util$util.addRecord(a.meta)}}).then(()=>{location.reload()})}else showNotLoggedInMessage$$module$js$module$contact_us()});
$("*[data-action='approve']").off();$("*[data-action='approve']").click(c=>{b._approveItem(c)});$("*[data-action='delete']").off();$("*[data-action='delete']").click(c=>{c.preventDefault();if(Login$$module$js$module$login.isAuthenticated()){c=$(c.currentTarget).data("record-id");var d=dataset_helper$$module$js$util$util.createForDelete(a.meta,[c]),e=document.datwik_api_url;modal_helper$$module$js$util$modal.show({template:b.confirmModalTemplate,message:"Are you sure you want to delete this entry?",
confirmToastMessage:"Entry deleted",onConfirm:function(){return rest$$module$js$util$util.delete(e+"/action/dataset",d)}}).then(()=>{location.reload()}).catch(function(f){})}else showNotLoggedInMessage$$module$js$module$contact_us()});$("*[data-action='report']").off();$("*[data-action='report']").click(c=>{b._reportItem(c)});$("*[data-action='change-layout']").off();$("*[data-action='change-layout']").click(c=>{c.preventDefault();0!=a.records.length&&(b.layout=b.layout?"":"table",b._navigatePage())});
$("*[data-action='page-next']").off();$("*[data-action='page-next']").click(c=>{c.preventDefault();0!=a.records.length&&(b.page+=1,b._navigatePage())});$("*[data-action='page-previous']").off();$("*[data-action='page-previous']").click(c=>{c.preventDefault();2>this.page||(--b.page,b._navigatePage())});$("*[data-sort-id]").off();$("*[data-sort-id]").click(c=>{c.preventDefault();c=$(c.currentTarget).data("sort-id");b.sort=b.sort?c==b.sort?-b.sort:c==-b.sort?null:c:c;b._navigatePage()});$("*[data-action='search-record']").off();
$("*[data-action='search-record']").click(c=>{c.preventDefault();b.search=$("input[data-input='search-record']")[0].value;b.page=1;b._navigatePage()});$("*[data-action='search-clear']").off();$("*[data-action='search-clear']").click(c=>{c.preventDefault();b.search=null;b._navigatePage()})},topic_events:function(a){let b=this,c=a.topic.records[0].id;$("*[data-action='delete-topic']").off();$("*[data-action='delete-topic']").click(d=>{d.preventDefault();if(Login$$module$js$module$login.isAuthenticated()){var e=
document.datwik_api_url;modal_helper$$module$js$util$modal.show({template:b.confirmModalTemplate,message:"Are you sure you want to delete this topic?",confirmToastMessage:"Topic deleted",onConfirm:function(){return rest$$module$js$util$util.delete(e+"/topic/"+c)}}).then(()=>{location.href="/"}).catch(function(f){})}else showNotLoggedInMessage$$module$js$module$contact_us()});$("*[data-action='design-topic']").off();$("*[data-action='design-topic']").click(d=>{d.preventDefault();Login$$module$js$module$login.isAuthenticated()?
location.href=`/design/${c}/${this.dataset_title}`:showNotLoggedInMessage$$module$js$module$contact_us()});$("*[data-action='approve-topic']").off();$("*[data-action='approve-topic']").click(d=>{b._approveItem(d)});$("*[data-action='report-topic']").off();$("*[data-action='report-topic']").click(d=>{b._reportItem(d)});$("*[data-action='update-topic']").off();$("*[data-action='update-topic']").click(d=>{d.preventDefault();Login$$module$js$module$login.isAuthenticated()?($('*[data-section^="topic-display-"]').addClass("d-none"),
$('*[data-section^="topic-edit-"]').removeClass("d-none")):showNotLoggedInMessage$$module$js$module$contact_us()});$("*[data-action='topic-edit-cancel']").off();$("*[data-action='topic-edit-cancel']").click(d=>{d.preventDefault();$('*[data-section^="topic-edit-"]').addClass("d-none");$('*[data-section^="topic-display-"]').removeClass("d-none")});$("*[data-action='topic-edit-save']").off();$("*[data-action='topic-edit-save']").click(d=>{d.preventDefault();d=a.topic;let e=d.records[0],f=$("#topic-question-value").val(),
g=$("#topic-tags-value").val();g=g.split(",");let h=$("#topic-description-value").val(),k=[f,e.vals[1],g,h];d=dataset_helper$$module$js$util$util.createForUpdate(d.meta,e.id,k);rest$$module$js$util$util.put(document.datwik_api_url+"/topic/",d).then(()=>{e.vals=k;toast_helper$$module$js$util$modal.show("Saved topic","text-white bg-success");b._navigatePage()}).catch(l=>{toast_helper$$module$js$util$modal.show(l.message,"text-white bg-danger")})})},_setLastPage:function(){this.page=Math.floor(window.topic_data.dataset.meta.stats.row_count/
window.topic_data.dataset.filter.size)+1;this.sort=this.search=null},_approveItem:function(a){a.preventDefault();if(Login$$module$js$module$login.isAuthenticated()){var b=$(a.currentTarget).data("record-id");rest$$module$js$util$util.post(document.datwik_api_url+"/action/dataset/approve/"+b).then(c=>{$(`*[data-approve-score-counter='${b}']`).html(c.approve_score)}).catch(c=>{toast_helper$$module$js$util$modal.show("Unable to approve"+(c.message?": "+c.message:""),"text-white bg-danger")})}else showNotLoggedInMessage$$module$js$module$contact_us()},
_reportItem:function(a){a.preventDefault();if(Login$$module$js$module$login.isAuthenticated()){var b=$(a.currentTarget).data("record-id");modal_helper$$module$js$util$modal.show({template:this.confirmModalTemplate,message:"Are you sure you want to report this entry?",confirmToastMessage:"Thank you for reporting",onConfirm:function(){return rest$$module$js$util$util.post(document.datwik_api_url+"/action/dataset/report/"+b)}}).catch(c=>{toast_helper$$module$js$util$modal.show("Unable to report"+(c.message?
": "+c.message:""),"text-white bg-danger")})}else showNotLoggedInMessage$$module$js$module$contact_us()},_navigatePage:function(){location.href=this._buildParams(this.dataset_id==FEEDBACK_DATASET$$module$js$module$table?"/feedback":`/topic/${this.dataset_id}/${this.dataset_title}`)},_buildParams(a){return buildParams$$module$js$util$util(a,this)},_loadParams:function(){loadParams$$module$js$util$util(this)},init:function(a,b,c){this.el=a;this.dataset_id=b;this.dataset_title=c;this._loadParams();this.render()},
render:async function(){DataTable$$module$js$module$table.events(window.topic_data.dataset);DataTable$$module$js$module$table.topic_events(window.topic_data);this._renderSort()},_renderSort:function(){this.sort&&($("*[data-sort-marker-id]").addClass("d-none"),0<this.sort?$(`*[data-sort-marker-id=${this.sort}][data-sort-marker="down"]`).removeClass("d-none"):$(`*[data-sort-marker-id=${-this.sort}][data-sort-marker="up"]`).removeClass("d-none"))}};var module$js$module$table={};
module$js$module$table.DataTable=DataTable$$module$js$module$table;module$js$module$table.FEEDBACK_DATASET=FEEDBACK_DATASET$$module$js$module$table;const TopicTable$$module$js$module$topic_table={el:null,template:Handlebars.compile($("#topic-list-template").html()),loadingTemplate:Handlebars.compile($("#topic-list-loading-template").html()),dynamicTableTemplate:Handlebars.compile($("#topic-list-dynamic-table-template").html()),page:0,sort:null,search:null,tag:null,events:function(a){var b=this;$("*[data-action='topic-show']").off();$("*[data-action='topic-show']").click(c=>{c.preventDefault();c=$(c.currentTarget).data("topic-id");window.app.router().navigateTo(`/topic/${c}`)});
$("*[data-action='topic-tag-search']").off();$("*[data-action='topic-tag-search']").click(c=>{c.preventDefault();b.page=1;b.tag=$(c.currentTarget).data("tag");b.search=null;b._navigatePage()});$("*[data-action='page-next']").off();$("*[data-action='page-next']").click(c=>{c.preventDefault();0!=a.records.length&&(b.page+=1,b._navigatePage())});$("*[data-action='page-previous']").off();$("*[data-action='page-previous']").click(c=>{c.preventDefault();2>this.page||(--b.page,b._navigatePage())})},_navigatePage:function(){window.app.router().navigateTo(this._buildParams("/topic"))},
_buildParams(a){return buildParams$$module$js$util$util(a,this)},_loadParams:function(){loadParams$$module$js$util$util(this)},init:function(a){this.el=a;this._loadParams();this.render()},render:async function(){let a=this;a.el.html(this.loadingTemplate());rest$$module$js$util$util.get(document.datwik_api_url+this._buildParams("/action/topics")).then(b=>{a.el.html(this.template());$("#dynamic-topic-table").html(a.dynamicTableTemplate({data:b,page:a.page}));TopicTable$$module$js$module$topic_table.events(b);
a._renderSort();a._renderSearch()})},_renderSort:function(){this.sort&&($("*[data-sort-marker-id]").addClass("invisible"),0<this.sort?$(`*[data-sort-marker-id=${this.sort}][data-sort-marker="down"]`).removeClass("invisible"):$(`*[data-sort-marker-id=${-this.sort}][data-sort-marker="up"]`).removeClass("invisible"))},_renderSearch:function(){this.search&&($("input[data-input='search-topic']")[0].value=this.search)}};var module$js$module$topic_table={};module$js$module$topic_table.TopicTable=TopicTable$$module$js$module$topic_table;let EmptyField$$module$js$module$add_topic={name:null,type:null,required:!1},EditorMode$$module$js$module$add_topic={ADD_SIMPLE:0,ADD_ADVANCED:1,EDIT:1};
const AddTopic$$module$js$module$add_topic={el:null,template:compile_template$$module$js$util$util("#add-topic-template"),templateSimple:compile_template$$module$js$util$util("#add-topic-simple-template"),templateAdvanced:compile_template$$module$js$util$util("#add-topic-advanced-template"),loadingTemplate:Handlebars.compile($("#topic-list-loading-template").html()),mode:EditorMode$$module$js$module$add_topic.ADD_SIMPLE,fields:[{...EmptyField$$module$js$module$add_topic}],meta_id:null,title_slug:null,
events:function(){var a=this;$("*[data-action='topic-add']").off();$("*[data-action='topic-add']").click(b=>{b.preventDefault();Login$$module$js$module$login.isAuthenticated()?a.submitAddTopic():showNotLoggedInMessage$$module$js$module$contact_us()});$("*[data-action='topic-design']").off();$("*[data-action='topic-design']").click(b=>{b.preventDefault();Login$$module$js$module$login.isAuthenticated()?a.submitEditTopic():showNotLoggedInMessage$$module$js$module$contact_us()});$("*[data-action='design-cancel']").off();
$("*[data-action='design-cancel']").click(b=>{b.preventDefault();Login$$module$js$module$login.isAuthenticated()?window.location.href=`/topic/${this.topic_id}/${this.title_slug}`:showNotLoggedInMessage$$module$js$module$contact_us()});$("*[data-action='show-advanced']").off();$("*[data-action='show-advanced']").click(b=>{b.preventDefault();a.mode=a.mode==EditorMode$$module$js$module$add_topic.ADD_SIMPLE?EditorMode$$module$js$module$add_topic.ADD_ADVANCED:EditorMode$$module$js$module$add_topic.ADD_SIMPLE;
a.renderSimple();a.renderAdvanced();a.events()});$("*[data-action='field-add']").off();$("*[data-action='field-add']").click(b=>{b.preventDefault();32<=a.fields.length?toast_helper$$module$js$util$modal.show("Topic cannot have more than 32 fields","text-white bg-danger"):(a.recordValues(),a.fields.push({...EmptyField$$module$js$module$add_topic}),a.renderAdvanced(),a.events())});$("*[data-action='field-remove']").off();$("*[data-action='field-remove']").click(b=>{b.preventDefault();1>=a.fields.length?
toast_helper$$module$js$util$modal.show("Topic needs to have at least 1 field","text-white bg-danger"):(b=$(b.currentTarget).data("index"),a.recordValues(),a.fields.splice(b,1),a.renderAdvanced(),a.events())});$("*[data-action='field-up']").off();$("*[data-action='field-up']").click(b=>{b.preventDefault();b=$(b.currentTarget).data("index");a.recordValues();if(0<b){let c=a.fields.splice(b,1);a.fields.splice(b-1,0,c[0])}a.renderAdvanced();a.events()});$("*[data-action='field-down']").off();$("*[data-action='field-down']").click(b=>
{b.preventDefault();b=$(b.currentTarget).data("index");a.recordValues();if(b<a.fields.length-1){let c=a.fields.splice(b,1);a.fields.splice(b+1,0,c[0])}a.renderAdvanced();a.events()})},validate:function(a){a=!0;var b=$("#topic-question-value"),c=$("#topic-tags-value"),d=$("#topic-type-value");[b,c,d].forEach(f=>{f.prop("classList").remove("is-invalid");f.prop("classList").remove("is-valid")});var e=b.val();c.val();c=d.val();(e=validator.isLength(e,{min:5,max:200}))||b.prop("classList").add(e?"is-valid":
"is-invalid");a=a&&e;this.mode==EditorMode$$module$js$module$add_topic.ADD_SIMPLE?(b=null!=meta_helper$$module$js$util$util.types[c],d.prop("classList").add(b?"is-valid":"is-invalid"),a=a&&b):(d=this.validateFields(),a=a&&d);return a},validateFields:function(){return this.fields.map((a,b)=>{var c=$(`*[data-field-attribute="${b}-name"]`);a=$(`*[data-field-attribute="${b}-type"]`);b=$(`*[data-field-attribute="${b}-options"]`);[c,a,b].forEach(h=>{h.prop("classList").remove("is-invalid");h.prop("classList").remove("is-valid")});
var d=c.val();let e=a.val(),f=b.val();var g=!0;(d=validator.isLength(d,{min:2,max:50})&&validator.isAlphanumeric(d,"en-US",{ignore:" -"}))||c.prop("classList").add(d?"is-valid":"is-invalid");g=g&&d;(c=0<=e)||a.prop("classList").add(c?"is-valid":"is-invalid");g=g&&c;e==FieldType$$module$js$util$util.OPTION&&(a=validator.isLength(f,{min:3,max:100}),b.prop("classList").add(a?"is-valid":"is-invalid"),g=g&&a);return g}).reduce((a,b)=>a&&b)},recordValues:function(){this.fields.forEach((a,b)=>{a.name=$(`*[data-field-attribute="${b}-name"]`).val();
a.type=$(`*[data-field-attribute="${b}-type"]`).val();a.required=$(`*[data-field-attribute="${b}-required"]`).is(":checked");a.options=$(`*[data-field-attribute="${b}-options"]`).val()})},buildDatasetMeta:function(){if(this.mode==EditorMode$$module$js$module$add_topic.ADD_ADVANCED){this.recordValues();var a=this.fields.map(b=>{b={...b};b.type=Number(b.type);b.options?b.options=b.options.split(",").map((c,d)=>({d,v:c})):delete b.options;b.required||delete b.required;return b});return{id:this.meta_id,
name:"custom",fields:a}}a=$("#topic-type-value").val();return meta_helper$$module$js$util$util.types[a]},submitAddTopic:function(){let a=$("#topic-question-value").val();var b=$("#topic-tags-value").val();let c=$("#topic-description-value").val();b=b.split(",");if(this.validate()){var d=this.buildDatasetMeta();b={topic:dataset_helper$$module$js$util$util.createForAdd(meta_helper$$module$js$util$util.topic,[a,null,b,c]),dataset:{meta:d}};rest$$module$js$util$util.post(document.datwik_api_url+"/topic/",
b).then(e=>{toast_helper$$module$js$util$modal.show("Added new topic","text-white bg-success");window.location.href=`/topic/${e.tid}/${slug$$module$js$util$util(a)}`}).catch(function(e){toast_helper$$module$js$util$modal.show(e.message,"text-white bg-danger")})}},submitEditTopic:function(){if(this.validateFields()){var a=this,b=this.buildDatasetMeta();console.log(JSON.stringify(b));rest$$module$js$util$util.put(document.datwik_api_url+"/topic/design",b).then(c=>{console.log("data",JSON.stringify(c),
a.topic_id,a.title_slug);toast_helper$$module$js$util$modal.show("Updated topic structure","text-white bg-success");window.location.href=`/topic/${a.topic_id}/${a.title_slug}`}).catch(function(c){toast_helper$$module$js$util$modal.show(c.message,"text-white bg-danger")})}},init:function(a,b){this.el=a;this.el.html(this.template({authenticated:Login$$module$js$module$login.isAuthenticated(),edit_mode:!1}));this.render(b)},render:async function(){this.renderSimple();this.renderAdvanced();AddTopic$$module$js$module$add_topic.events()},
renderSimple:function(){$('*[data-section="topic-simple"]').html(this.templateSimple({topic_types:Object.keys(meta_helper$$module$js$util$util.types),authenticated:!0,advancedMode:this.mode==EditorMode$$module$js$module$add_topic.ADD_ADVANCED}))},renderAdvanced:function(){let a=$('*[data-section="topic-advanced"]');$('*[data-action="show-advanced"]').html(this.mode==EditorMode$$module$js$module$add_topic.ADD_ADVANCED?"Simple":"Advanced");if(this.mode==EditorMode$$module$js$module$add_topic.ADD_SIMPLE)a.html("");
else{var b=Object.keys(FieldType$$module$js$util$util).map(c=>({k:FieldType$$module$js$util$util[c],v:c}));a.html(this.templateAdvanced({authenticated:!0,field_types:b,fields:this.fields}))}},init_design:function(a,b,c){this.el=a;this.mode=EditorMode$$module$js$module$add_topic.EDIT;this.topic_id=b;this.title_slug=c;this.renderAdvancedDesign(b)},renderAdvancedDesign:function(a){let b=this;b.el.html(this.loadingTemplate());rest$$module$js$util$util.get(document.datwik_api_url+"/topic/meta/"+b.topic_id).then(c=>
{b.el.html(this.template({authenticated:!0,edit_mode:!0}));let d=$('*[data-section="topic-advanced"]'),e=Object.keys(FieldType$$module$js$util$util).map(f=>({k:FieldType$$module$js$util$util[f],v:f}));b.fields=c.fields;b.meta_id=c.id;b.fields.forEach(f=>{f.type=FieldType$$module$js$util$util[f.type];if(f.options){let g=f.options.map(h=>h.v);f.options=g}});d.html(this.templateAdvanced({authenticated:!0,field_types:e,fields:b.fields,edit_mode:!0}));AddTopic$$module$js$module$add_topic.events()})}};
var module$js$module$add_topic={};module$js$module$add_topic.AddTopic=AddTopic$$module$js$module$add_topic;const Register$$module$js$module$register={el:null,template:compile_template$$module$js$util$util("#register-template"),events:function(){$("*[data-action='register']").off();$("*[data-action='register']").click(a=>{a.preventDefault();let b={username:$("*[data-input='username']").val(),password:$("*[data-input='password']").val(),email:$("*[data-input='email']").val(),agree_terms_privacy:$("*[data-input='agree_terms_privacy']").is(":checked"),agree_emails:$("*[data-input='agree_emails']").is(":checked")};
rest$$module$js$util$util.post(document.datwik_api_url+"/auth/register",b).then(c=>{toast_helper$$module$js$util$modal.show(`Successfully registered ${b.username}`,"text-white bg-success");window.app.router().navigateTo("/login")}).catch(c=>{toast_helper$$module$js$util$modal.show(`Error during registration: ${c.message}`,"text-white bg-danger")})})},init:function(a){this.el=a;this.render()},render:async function(){this.el.html(this.template({}));this.events()}};var module$js$module$register={};
module$js$module$register.Register=Register$$module$js$module$register;const Home$$module$js$module$home={el:null,template:Handlebars.compile($("#home-template").html()),events:function(){$("*[data-action='search-topic-main']").off();$("*[data-action='search-topic-main']").click(a=>{a.preventDefault();(a=$("input[data-input='search-topic-main']").val())&&""!=a.trim()?window.app.router().navigateTo(`/topic/?search=${a}`):toast_helper$$module$js$util$modal.show("Please enter search term","bg-info")})},init:function(a){this.el=a;this.render();Home$$module$js$module$home.events()},
render:async function(){this.el.html(this.template())}};var module$js$module$home={};module$js$module$home.Home=Home$$module$js$module$home;const Profile$$module$js$module$profile={el:null,template:compile_template$$module$js$util$util("#profile-template"),events:function(){$("*[data-action='change-password']").off();$("*[data-action='change-password']").click(a=>{a.preventDefault();a={password:$("*[data-input='password']").val(),email:$("*[data-input='email']").val(),new_password:$("*[data-input='new-password']").val()};if(""==a.email||""==a.password||""==a.new_password)toast_helper$$module$js$util$modal.show("Please enter all values",
"text-white bg-danger");else{var b=$("*[data-input='new-password-repeat']").val();a.new_password!=b?toast_helper$$module$js$util$modal.show("Please enter same new password twice","text-white bg-danger"):rest$$module$js$util$util.post(document.datwik_api_url+"/auth/change_password",a).then(c=>{toast_helper$$module$js$util$modal.show(`Successfully changed password for ${c.username}`,"text-white bg-success");window.app.router().navigateTo("/")}).catch(c=>{toast_helper$$module$js$util$modal.show(`Error during password change: ${c.message}`,
"text-white bg-danger")})}})},init:function(a){this.el=a;this.render()},render:async function(){this.el.html(this.template({}));this.events()}};var module$js$module$profile={};module$js$module$profile.Profile=Profile$$module$js$module$profile;const app$$module$js$app={el:$("#app"),errorTemplate:Handlebars.compile($("#error-template").html()),_router:null,initState:!0,init:function(){this._initRouter();this._initMenu()},_initMenu:function(){var a=this;$(`a[href$='${window.location.pathname}']`).addClass("active");$("a[data-nav]").on("click",b=>{b.preventDefault();b=$(b.target);$(".nav-link").removeClass("active");b.addClass("active");b=b.attr("href");b=b.substr(b.lastIndexOf("/"));a.router().navigateTo(b)});$("*[data-action='search-topic']").off();
$("*[data-action='search-topic']").click(b=>{b.preventDefault();b=$("input[data-input='search-topic']").val();window.app.router().navigateTo(`/topic/?search=${b}`)});$("*[data-action='search-topic-clear']").off();$("*[data-action='search-topic-clear']").click(b=>{b.preventDefault();$("input[data-input='search-topic']").val("");window.app.router().navigateTo("/")});$("*[data-action='contact-us']").off();$("*[data-action='contact-us']").click(b=>{b.preventDefault();showContactUsDialog$$module$js$module$contact_us()});
window.readOnlyWebsite||Login$$module$js$module$login.initAuthMenuItems()},_initRouter:function(){var a=this;this._router=new Router({mode:"history",page404:b=>{b=a.errorTemplate({color:"yellow",title:"Error 404 - Page NOT Found!",message:`The path '/${b}' does not exist on this site`});a.el.html(b)}});a._router.add("/",()=>{Home$$module$js$module$home.init(a.el)}).add("topic",()=>{TopicTable$$module$js$module$topic_table.init(a.el)}).add("ask",()=>{AddTopic$$module$js$module$add_topic.init(a.el)}).add("design/{id}/{title}",
(b,c)=>{AddTopic$$module$js$module$add_topic.init_design(a.el,b,c)}).add("feedback",()=>{a.initState||(location.href="/feedback");DataTable$$module$js$module$table.init(a.el,FEEDBACK_DATASET$$module$js$module$table,"feedback")}).add("topic/{id}/{title}",(b,c)=>{a.initState||(location.href=`/topic/${b}/${c}`);DataTable$$module$js$module$table.init(a.el,b,c)}).add("login",()=>{Login$$module$js$module$login.init(a.el)}).add("profile",()=>{Profile$$module$js$module$profile.init(a.el)}).add("register",
()=>{Register$$module$js$module$register.init(a.el)}).addUriListener().check();a.initState=!1},router:function(){return this._router}};window.addEventListener("load",()=>{window.app=app$$module$js$app;app$$module$js$app.init()});var module$js$app={};Handlebars.registerHelper("timeago",function(a){return timeago.format(new Date(1E3*a))});Handlebars.registerHelper("capitalize",function(a){return a.capitalize()});Handlebars.registerHelper("lower",function(a){return a.toLowerCase()});Handlebars.registerHelper("faviconUrl",function(a){try{return`https://f1.allesedv.com/16/${(new URL(a)).hostname.split(".").slice(-2).join(".")}`}catch(b){return""}});
Handlebars.registerHelper("refDatwik",function(a){try{let b=new URL(a);return b.search&&0<b.search.length?`${b.href}&ref=datwik.com`:`${b.href}?ref=datwik.com`}catch(b){return a}});Handlebars.registerHelper("repeatToFillRemainder",function(a,b,c){var d="";let e=a%b;if(!e)return d;a=0;for(b-=e;a<b;a++)d+=c.fn();return d});Handlebars.registerHelper("ifLastElementBeforeBoundary",function(a,b,c,d){return b==a-1&&0<(b+1)%c?d.fn(this):d.inverse(this)});
Handlebars.registerHelper("ifItemGroupBoundary",function(a,b,c){return 0<a&&0==a%b?c.fn(this):c.inverse(this)});Handlebars.registerHelper("ifEquals",function(a,b,c){return a==b?c.fn(this):c.inverse(this)});Handlebars.registerHelper("iif",function(a,b,c){return a?b:c});Handlebars.registerHelper("ifNotBlankString",function(a,b){var c=void 0!=a;c&&("string"===typeof a||a instanceof String)&&(c=""!=a.trim());return c?b.fn(this):b.inverse(this)});
Handlebars.registerHelper("ifNotEmptyValue",function(a,b,c,d){return isNotEmpty$$module$js$util$util(a[b],c)?d.fn(this):d.inverse(this)});Handlebars.registerHelper("moneyValue",function(a,b){return formatMoney$$module$js$util$util(a[b])});Handlebars.registerHelper("stringValue",function(a,b){return a[b]});Handlebars.registerHelper("optionValue",function(a,b,c){let d=b[c];return(a=a.filter(e=>e.d==d))&&0<a.length?a[0].v:""});
Handlebars.registerHelper("optionSelected",function(a,b,c){return b?a==b[c]?"selected":"":""});Handlebars.registerHelper("optionKeySelected",function(a,b,c){b=b.filter(d=>d.k==c);return b.length?a==b[0].k?"selected":"":""});Handlebars.registerHelper("checkboxChecked",function(a){return a?"checked":""});Handlebars.registerHelper("urlSuffix",function(a){return slug$$module$js$util$util(a)});var module$js$util$handlebars_helpers={};
